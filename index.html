<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ridge Capital Solutions — Live Attendance Board</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
<div class="max-w-7xl mx-auto">
<div class="flex items-center justify-between mb-6">
<h1 class="text-3xl font-bold">Ridge Capital Solutions — Shared Live Board (EST)</h1>
<a href="https://docs.google.com/spreadsheets/d/12rFLpvuiD_OaAec8Mf9d0Wgpj5OUZAJVbThkNRu9xiY/edit?gid=1991191224#gid=1991191224" target="_blank" class="bg-gray-800 text-white px-3 py-1 rounded text-sm">Report</a>
</div>

<div class="bg-white rounded-2xl shadow p-6 mb-6 grid md:grid-cols-5 gap-3">
<select id="name" class="border rounded-xl p-3">
<option value="">Select Employee</option>
<option>Aira</option><option>Hazel</option><option>AJ</option><option>James</option><option>Michael</option><option>Denmark</option><option>Randy</option>
</select>
<button onclick="login()" class="bg-blue-600 text-white rounded-xl p-3">Login</button>
<button onclick="lunch()" class="bg-yellow-500 text-white rounded-xl p-3">Lunch</button>
<button onclick="breakTime()" class="bg-orange-500 text-white rounded-xl p-3">Break</button>
<button onclick="logout()" class="bg-red-600 text-white rounded-xl p-3">Logout</button>
</div>

<div class="bg-white rounded-2xl shadow p-6 mb-6">
<h2 class="text-xl font-semibold mb-3">Live Tracker</h2>
<table class="w-full border text-sm">
<thead class="bg-gray-200"><tr><th class="border p-2">Name</th><th class="border p-2">Login</th><th class="border p-2">Logout</th><th class="border p-2">Last Event</th><th class="border p-2">Time (EST)</th></tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

<script>
const PASSWORD='Ridge2026!';
const SHEET_POST_URL='https://script.google.com/macros/s/AKfycbxUV3h8zWrJ_jzNw4ZSfrHPe9BycbcBH5tY-TrLBbQnbSTggnMZODcB_-RTCaXzoKg/exec';
const SHEET_CSV_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vS-RNPfhsGqVtC7zn0DEpKs762RSBzCT1pKTW79C78gP97Fiz1Mk5H04K8PZ15gjwgRXvEiL6emgeTr/pub?gid=1991191224&single=true&output=csv';


function estNow(){return new Date(new Date().toLocaleString('en-US',{timeZone:'America/New_York'}));}

async function postEvent(name,type){
 if(!name) return alert('Select employee');
 try{
  await fetch(SHEET_POST_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,type,date:estNow().toLocaleDateString('en-US'),time:estNow().toISOString()})});
  alert(type+' recorded');
  setTimeout(load,2000);
 }catch(e){alert('Failed to send log. Check Apps Script deployment permissions');}
}

function login(){postEvent(document.getElementById('name').value,'Login');}
function lunch(){postEvent(document.getElementById('name').value,'Lunch');}
function breakTime(){postEvent(document.getElementById('name').value,'Break');}
function logout(){postEvent(document.getElementById('name').value,'Logout');}

async function load(){
 try{
  const res=await fetch(SHEET_CSV_URL+"&t="+Date.now());
  const text=await res.text();
  const rows=text.split('\n').slice(1).map(r=>r.split(','));
  const data={};
  rows.forEach(r=>{
    const name=r[0]; const type=r[1]; const time=r[3];
    if(!name) return;
    if(!data[name]) data[name]={login:'-',logout:'-',last:type,time};
    if(type==='Login') data[name].login=new Date(time).toLocaleTimeString('en-US',{timeZone:'America/New_York'});
    if(type==='Logout') data[name].logout=new Date(time).toLocaleTimeString('en-US',{timeZone:'America/New_York'});
    data[name].last=type; data[name].time=new Date(time).toLocaleTimeString('en-US',{timeZone:'America/New_York'});
  });
  const body=document.getElementById('tableBody'); body.innerHTML='';
  Object.keys(data).forEach(n=>{
    body.innerHTML+=`<tr><td class='border p-2'>${n}</td><td class='border p-2'>${data[n].login}</td><td class='border p-2'>${data[n].logout}</td><td class='border p-2'>${data[n].last}</td><td class='border p-2'>${data[n].time}</td></tr>`;
  });
 }catch(e){console.log('waiting for logs');}
}
setInterval(load,10000); load();
</script>
</body>
</html>
