<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ridge Capital Solutions — Live Attendance Board</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
<div class="max-w-7xl mx-auto">
<div class="flex items-center justify-between mb-6">
<h1 class="text-3xl font-bold">Ridge Capital Solutions — Shared Live Board (EST)</h1>
<a href="https://docs.google.com/spreadsheets/d/12rFLpvuiD_OaAec8Mf9d0Wgpj5OUZAJVbThkNRu9xiY/edit?gid=1991191224#gid=1991191224" target="_blank" class="bg-gray-800 text-white px-3 py-1 rounded text-sm">Report</a>
</div>

<div class="bg-white rounded-2xl shadow p-6 mb-6 grid md:grid-cols-5 gap-3">
<select id="name" class="border rounded-xl p-3">
<option value="">Select Employee</option>
<option>Aira</option><option>Hazel</option><option>AJ</option><option>James</option><option>Michael</option><option>Denmark</option><option>Randy</option>
</select>
<button onclick="login()" class="bg-blue-600 text-white rounded-xl p-3">Login</button>
<button onclick="lunch()" class="bg-yellow-500 text-white rounded-xl p-3">Lunch</button>
<button onclick="breakTime()" class="bg-orange-500 text-white rounded-xl p-3">Break</button>
<button onclick="logout()" class="bg-red-600 text-white rounded-xl p-3">Logout</button>
</div>

<div class="bg-white rounded-2xl shadow p-6 mb-6">
<h2 class="text-xl font-semibold mb-3">Live Tracker</h2>
<table class="w-full border text-sm">
<thead class="bg-gray-200"><tr><th class="border p-2">Name</th><th class="border p-2">Shift</th><th class="border p-2">Login</th><th class="border p-2">Logout</th><th class="border p-2">Status</th></tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

<script>
const SHEET_POST_URL='https://script.google.com/macros/s/AKfycbxUV3h8zWrJ_jzNw4ZSfrHPe9BycbcBH5tY-TrLBbQnbSTggnMZODcB_-RTCaXzoKg/exec';
const SHEET_CSV_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vS-RNPfhsGqVtC7zn0DEpKs762RSBzCT1pKTW79C78gP97Fiz1Mk5H04K8PZ15gjwgRXvEiL6emgeTr/pub?gid=1991191224&single=true&output=csv';

const schedules={Aira:['09:00','18:00'],Hazel:['10:00','19:00'],AJ:['09:00','16:00'],James:['08:00','15:00'],Michael:['10:00','19:00'],Denmark:['10:00','20:00'],Randy:['12:00','21:00']};
const requiredMin=name=>['Aira','Hazel','Michael','Denmark','Randy'].includes(name)?480:420;

function estNow(){return new Date(new Date().toLocaleString('en-US',{timeZone:'America/New_York'}));}
function mins(a,b){return Math.max(0,Math.floor((b-a)/60000));}

async function postEvent(name,type){
 if(!name) return alert('Select employee');
 await fetch(SHEET_POST_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,type,date:estNow().toLocaleDateString('en-US'),time:estNow().toISOString()})});
 setTimeout(load,2000);
}
function login(){postEvent(document.getElementById('name').value,'Login');}
function lunch(){postEvent(document.getElementById('name').value,'Lunch');}
function breakTime(){postEvent(document.getElementById('name').value,'Break');}
function logout(){postEvent(document.getElementById('name').value,'Logout');}

function shiftStartDate(name,base){const [h,m]=schedules[name][0].split(':');const d=new Date(base);d.setHours(h,m,0,0);return d;}

async function load(){
 try{
  const res=await fetch(SHEET_CSV_URL+"&t="+Date.now());
  const text=await res.text();
  const rows=text.split('\n').slice(1).map(r=>r.split(','));
  const today=estNow().toLocaleDateString('en-US');
  let events={};
  rows.forEach(r=>{const n=r[0],t=r[1],d=r[2],time=new Date(r[3]);if(!n||d!==today)return;if(!events[n])events[n]=[];events[n].push({type:t,time});});

  const body=document.getElementById('tableBody'); body.innerHTML='';
  Object.keys(schedules).forEach(name=>{
    const ev=(events[name]||[]).sort((a,b)=>a.time-b.time);
    let login=null,logout=null,lunchStart=null,lunchDur=0,breakActive=false,online=0,last=null;
    for(const e of ev){
      if(e.type==='Login'){login=e.time;last=e.time;}
      else if(e.type==='Lunch'&&login){
        if(!lunchStart){online+=mins(last,e.time);lunchStart=e.time;}
        else{lunchDur+=mins(lunchStart,e.time);last=e.time;lunchStart=null;}
      }
      else if(e.type==='Break'&&login){breakActive=!breakActive;}
      else if(e.type==='Logout'&&login){online+=mins(last,e.time);logout=e.time;last=null;}
    }
    if(login&&last) online+=mins(last,estNow());

    let status='Offline';
    if(login) status='Online';
    if(lunchStart) status = mins(lunchStart,estNow())>60 ? 'Overlunch':'Lunch';
    if(breakActive) status='Quick Bio';
    if(login){const late=Math.max(0,mins(new Date(shiftStartDate(name,login).getTime()+10*60000),login)); if(late>0) status='Late';}
    if(logout && online<requiredMin(name)) status='Undertime';

    body.innerHTML+=`<tr><td class='border p-2'>${name}</td><td class='border p-2'>${schedules[name][0]}-${schedules[name][1]}</td><td class='border p-2'>${login?login.toLocaleTimeString('en-US',{timeZone:'America/New_York'}):'-'}</td><td class='border p-2'>${logout?logout.toLocaleTimeString('en-US',{timeZone:'America/New_York'}):'-'}</td><td class='border p-2'>${status}</td></tr>`;
  });
 }catch(e){console.log('waiting for logs');}
}
setInterval(load,10000); load();
</script>
</body>
</html>
